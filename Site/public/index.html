<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="shortcut icon" href="assets/imagens_site/icon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/3f0399636b.js" crossorigin="anonymous"></script>
    <script src="../js/funcoes.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script> --> 
</head>

<body onload="imagens_home()">

    <div class="navbar">
        <h1 class="titulo">
            <b> <a href="index.html"> TOP 50 </a> </b>
        </h1>
        <div class="itens">
            <p class="lista">
                <a href="javascript:window.scrollTo({left: 0,top: 1400, behavior: 'smooth'})"> Rankings </a>
            </p>

            <p class="playlists">
                <a href="javascript:window.scrollTo({left: 0,top: 3250, behavior: 'smooth'})"> Quiz </a>
            </p>

            <p>
                <a href="javascript:window.scrollTo({left: 0,top: 4570, behavior: 'smooth'})">Gráficos</a>
            </p>

            <p>
                <a href="javascript:window.scrollTo({left: 0,top: 5420, behavior: 'smooth'})">Notícias</a>
            </p>
        </div>
    </div>

    <div class="container">
        <span class="bem_vindo">SEJA BEM VINDO AO TOP50</span>
    </div>
    <div class="container">
        <span class="mensagem_boas_vindas">Seu melhor portal especializado em música!</span>
    </div>

    <div class="container">
        <div id="imagem_home" class="imagem_home"></div>
    </div>

    <div class="container">
        <span style="margin-top: 75px;" class="mensagem_boas_vindas">Aproveite tudo que nosso site tem a ofercer!</span>
    </div>

    <div class="container">
        <div class="titulo_ranking">RANKINGS TOP 50</div>
    </div>

    <!-- <div class="texto-user">
        <span>Bem-vindo</span>
        <span id="b_usuario"></span>
    </div> -->

    <div class="container">
        <div class="quadrado">
            <div class="div_cabecalho">
                <div class="barra1"></div>
                <p> Top 50 </p>
                <div class="barra2"></div>
            </div>
            <div class="coluna">
                <img style="height: 130px;" width="130px" src="assets/Imagens/born_to_die.jpg" alt="">
                <span>1</span>
                <div class="linha-vertical2"></div>
                <div class="dados_musicas">
                    <b class="nome_musica">
                        Summertime Sadness (2012) -<br>
                    </b>
                    Lana Del Rey
                </div>
            </div>
            <div class="coluna">
                <img style="height: 130px;" width="130px" src="assets/Imagens/mr.morale.jpg" alt="">
                <span>2</span>
                <div class="linha-vertical2"></div>
                <div class="dados_musicas">
                    <b class="nome_musica">
                        United In Grief (2022) -<br>
                    </b>
                    Kendrick Lamar
                </div>
            </div>
            <div class="coluna">
                <img style="height: 130px;" width="130px" src="assets/Imagens/N_anavitoria.jpg" alt="">
                <span>3</span>
                <div class="linha-vertical2"></div>
                <div class="dados_musicas">
                    <b class="nome_musica">
                        As coisas tão mais lindas (2019) -<br>
                    </b>
                    ANAVITÓRIA
                </div>
            </div>
            <div class="coluna">
                <img style="height: 130px;" width="130px" src="assets/Imagens/graduation.jpg" alt="">
                <span>4</span>
                <div class="linha-vertical2"></div>
                <div class="dados_musicas">
                    <b class="nome_musica">
                        Flashing Lights (2007) -<br>
                    </b>
                    Kanye West
                </div>
            </div>
            <div class="coluna">
                <img style="height: 130px;" width="130px" src="assets/Imagens/amarElo.jpg" alt="">
                <span>5</span>
                <div class="linha-vertical2"></div>
                <div class="dados_musicas">
                    <b class="nome_musica">
                        A Ordem Natural das Coisas (2019) -<br>
                    </b>
                    Emicida
                </div>
            </div>
            <div class="ver_tudo">
                <p style="font-size: 32px; margin-top: 32px;"> <a href="rankings/top_50.html"> Ver Tudo </a> </p>
            </div>
        </div>
    </div>

    <div class="container2">
        <div class="quadrado_menor">
            <div class="faixa">
                <p>Top 50 Nacional</p>
            </div>
            <div class="albuns">
                <div class="nomes">
                    <img style="height: 110px;" width="110px" src="assets/Imagens/apesar_de_voce.jpg" alt="">
                    <span>1</span>
                    <div class="linha-vertical"></div>
                    <div class="dados_albuns">
                        <b>
                            <p>Apesar de Você</p>
                        </b>
                        <p>Chico Buarque</p>
                    </div>
                </div>
                <div class="nomes">
                    <img style="height: 110px;" width="110px" src="assets/Imagens/dois_legiao.jpg" alt="">
                    <span>2</span>
                    <div class="linha-vertical"></div>
                    <div class="dados_albuns">
                        <b>
                            <p>Índios</p>
                        </b>
                        <p>Legião Urbana</p>
                    </div>
                </div>
                <div class="nomes">
                    <img style="height: 110px;" width="110px" src="assets/Imagens/Bocas_Ordinárias.jpg" alt="">
                    <span>3</span>
                    <div class="linha-vertical"></div>
                    <div class="dados_albuns">
                        <b>
                            <p>Só Por Uma Noite</p>
                        </b>
                        <p>Charlie Brown Jr.</p>
                    </div>
                </div>
            </div>
            <div class="ver_tudo">
                <p> <a href="rankings/nacional.html"> Ver Tudo </a> </p>
            </div>
        </div>

        <div class="quadrado_menor2">
            <div class="faixa">
                <p>Top 50 Álbuns</p>
            </div>
            <div class="albuns">
                <div class="nomes">
                    <img style="height: 110px;" width="110px" src="assets/Imagens/the_dark_side.png" alt="">
                    <span>1</span> <br>
                    <div class="linha-vertical"></div>
                    <div class="dados_albuns">
                        <b>
                            <p> The Dark Side <br> of the Moon</p>
                        </b>
                        <p>Pink Floyd</p>
                    </div>
                </div>
                <div class="nomes">
                    <img style="height: 110px;" width="110px" src="assets/Imagens/dawnFM.jpg" alt="">
                    <span>2</span> <br>
                    <div class="linha-vertical"></div>
                    <div class="dados_albuns">
                        <b>
                            <p>Dawn FM</p>
                        </b>
                        <p>The Weeknd</p>
                    </div>
                </div>
                <div class="nomes">
                    <img style="height: 110px;" width="110px" src="assets/Imagens/nada_como_um_dia.jpg" alt="">
                    <span>3</span> <br>
                    <div class="linha-vertical"></div>
                    <div class="dados_albuns">
                        <b>
                            <p> Nada Como um Dia <br> Após o Outro Dia</p>
                        </b>
                        <p>Racionais MC's</p>
                    </div>
                </div>
            </div>
            <div class="ver_tudo">
                <p> <a href="rankings/albuns.html"> Ver Tudo </a> </p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="titulo_conhecimento">TESTE SEU CONHECIMENTO</div>
    </div>

    <div class="container_quiz">
        <div class="quiz1">
            <div style="height: 90px;" class="faixa">
                <p style="font-size: 27px;">Qual a Música?</p>
            </div>
            <div style="margin-top: 20px;" class="container_card">
                <img style="height: 300px;" width="320px" src="assets/imagens_site/quiz_qual_musica.jpg" alt="">
            </div> <br>
            <div class="faixa_jogar">
                <p> <a href="quiz/quiz_qual_musica.html"> Jogar </a></p>
            </div>
        </div>

        <div class="quiz2">
            <div style="height: 90px;" class="faixa">
                <p style="font-size: 27px;"> Adivinhe o Albúm Pela Capa </p>
            </div>
            <div style="margin-top: 20px;" class="container_card">
                <img style="height: 300px;" width="320px" src="assets/imagens_site/quiz_albuns.png" alt="">
            </div> <br>
            <div class="faixa_jogar">
                <p> <a href="quiz/quiz_capa_album.html"> Jogar </a></p>
            </div>
        </div>
    </div>

    <div class="container_quiz">
        <div class="quiz3">
            <div style="height: 90px;" class="faixa">
                <p style="font-size: 27px;">Complete a Música</p>
            </div>
            <div style="margin-top: 20px;" class="container_card">
                <img style="height: 300px;" width="320px" src="assets/imagens_site/quiz_complete_musica.webp" alt="">
            </div> <br>
            <div class="faixa_jogar">
                <p> <a href="quiz/quiz_complete_musica.html"> Jogar </a></p>
            </div>
        </div>

        <div class="quiz4">
            <div style="height: 90px;" class="faixa">
                <p style="font-size: 27px;">Adivinhe o Artista</p>
            </div>
            <div style="margin-top: 20px;" class="container_card">
                <img style="height: 300px;" width="320px" src="assets/imagens_site/quiz_adivinhe_artista.jpg" alt="">
            </div> <br>
            <div class="faixa_jogar">
                <p> <a href="quiz/quiz_adivinhe_artista.html"> Jogar </a></p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="titulo_ranking">OS PREFERIDOS</div>
    </div>

    <div class="container">
        <div class="mensagem_graficos">
            <span>Acompanhe as músicas e álbuns mais votados <br></span>
            <div class="container">
                <span> como as favoritas de nossos usuários!</span>
            </div>
        </div>
    </div>

    <div class="container_graficos">
        <div class="chart">
            <canvas id="myChart"></canvas>
        </div>

        <div class="chart2">
            <canvas id="myChart2"></canvas>
        </div>
    </div>

    <div class="container">
        <div class="titulo_ranking">NOTICIAS</div>
    </div>

    <div style="margin-top: 80px;" class="noticias">
        <a href="noticias/thetown.html"> <img style="height: 200px; width: 285px;" src="assets/imagens_site/noticia1.webp"> </a>
        <div class="titulo_noticia"> 
            <span>
               <a href="noticias/thetown.html"> The Town: Foo Fighters e Bruno Mars esgotam ingressos; restam dias de Maroon 5 e Post Malone </a>
            </span>
        </div>
        <div class="creditos">
           <p> Por Léo Lopes </p>
        </div>
    </div>

    <div class="noticias">
        <a href="noticias/nirvana.html"> <img style="height: 200px; width: 285px;" src="assets/imagens_site/noticia2.jpg"> </a>
        <div class="titulo_noticia"> 
            <span style="margin-top: 30px;">
               <a href="noticias/nirvana.html"> Nirvana: Guitarra quebrada por Kurt Cobain é vendida por cerca de R$ 3 milhões </a>
            </span>
        </div>
        <div style="margin-top: 65px;" class="creditos">
           <p> Por Lianne Kolirin </p>
        </div>
    </div>

    <div class="noticias">
        <a href="noticias/emicida.html"> <img style="height: 200px; width: 285px;" src="assets/imagens_site/noticia3.jpg"> </a>
        <div class="titulo_noticia"> 
            <span style="margin-top: 40px;">
               <a href="noticias/emicida.html"> Rap: Do pior ao melhor álbum do Emicida </a>
            </span>
        </div>
        <div style="margin-top: 90px;" class="creditos">
           <p> Por Murilo Morgado </p>
        </div>
    </div>

    <div class="noticias">
        <a href="noticias/alcione.html"> <img style="height: 200px; width: 285px;" src="assets/imagens_site/noticia4.jpg"> </a>
        <div class="titulo_noticia"> 
            <span style="margin-top: 30px;">
               <a href="noticias/alcione.html"> MPB: Alcione é homenageada pelo Prêmio da Música Brasileira e louvada por artistas em sarau </a>
            </span>
        </div>
        <div style="margin-top: 30px;" class="creditos">
           <p> Por Gustavo Zeitel </p>
        </div>
    </div>

    <div class="noticias">
        <a href="noticias/matue.html"> <img style="height: 200px; width: 285px;" src="assets/imagens_site/noticia5.webp"> </a>
        <div class="titulo_noticia"> 
            <span style="margin-top: 30px;">
               <a href="noticias/matue.html"> Nacional: Matuê tem melhor estreia do rap nacional no Spotify </a>
            </span>
        </div>
        <div style="margin-top: 65px;" class="creditos">
           <p> Por Maria Dulce Miranda </p>
        </div>
    </div>

    <div class="footer">
        <p>
            <b>
                Feito com amor por um aluno ♥ SPTECH © 2023

            </b>
        </p>
        <p>
            <b>
                "aconteça o que aconteça, nada como um dia após outro dia"
            </b>
        </p>
    </div>

</body>

</html>

<script>
    var lista_imagens = ["<img style='height: 620px; width: 94%;margin-left: 43px;'src=assets/imagens_site/imagem_home.jpg>",
        "<img style='height: 620px; width: 94%;margin-left: 43px;'src=assets/imagens_site/imagem_home2.jpg>",
        "<img style='height: 620px; width: 94%; margin-left: 43px;' src=assets/imagens_site/imagem_home3.jpg>",
        "<img style='height: 620px; width: 94%; margin-left: 43px;' src=assets/imagens_site/imagem_home4.jpg>",
        "<img style='height: 620px; width: 94%; margin-left: 43px;' src=assets/imagens_site/imagem_home5.jpg>",
        "<img style='height: 620px; width: 94%;margin-left: 43px;' src=assets/imagens_site/imagem_home6.jpg>"
        ]

    function imagens_home() {
        var numero_aleatorio = parseInt(Math.random() * lista_imagens.length);
        imagem_home.innerHTML += `${lista_imagens[numero_aleatorio]}`
    }
</script>

 <script>

    const labels = [
        'Musica1',
        'Musica2',
        'Musica3',
        'Musica4',
        'Musica5'
    ];

    const data = {
        labels: labels,
        datasets: [{
            data: [30, 29, 28, 25, 22],
            backgroundColor: ['rgb(255,0,0)', 'rgb(0,255,0)', 'rgb(0,0,255)', 'rgb(255,255,0)', 'rgb(99,33,99)'],
            borderColor: 'white',
        }
        ]
    };

    const labels2 = [
        'Musica1',
        'Musica2',
        'Musica3',
        'Musica4',
        'Musica5'
    ];

    const data2 = {
        labels: labels2,
        datasets: [{
            data: [22, 24, 27, 23, 20],
            backgroundColor: ['rgb(255,0,0)', 'rgb(0,255,0)', 'rgb(0,0,255)', 'rgb(255,255,0)', 'rgb(99,33,99)'],
            borderColor: 'white',
        }]
    };

    const config = {
        type: 'pie',
        data: data
    };

    const config2 = {
        type: 'pie',
        data: data2,
        options: {}
    };
</script>

<script>
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );

    const myChart2 = new Chart(
        document.getElementById('myChart2'),
        config2
    );

</script> 

<script>

var lista_imagens = ["<img style='height: 620px; width: 94%;margin-left: 43px;'src=assets/imagens_site/imagem_home.jpg>",
        "<img style='height: 620px; width: 94%;margin-left: 43px;'src=assets/imagens_site/imagem_home2.jpg>",
        "<img style='height: 620px; width: 94%; margin-left: 43px;' src=assets/imagens_site/imagem_home3.jpg>",
        "<img style='height: 620px; width: 94%; margin-left: 43px;' src=assets/imagens_site/imagem_home4.jpg>",
        "<img style='height: 620px; width: 94%; margin-left: 43px;' src=assets/imagens_site/imagem_home5.jpg>"]

    function imagens_home() {
        var numero_aleatorio = parseInt(Math.random() * lista_imagens.length);
        imagem_home.innerHTML += `${lista_imagens[numero_aleatorio]}`
    }

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO



    let proximaAtualizacao;

    window.onload = obterDadosGrafico(1);


    function obterDadosGrafico(idAquario) {

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }


        fetch(`/medidas/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGrafico(resposta, idAquario);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Esta função plotarGrafico usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função plotarGrafico também invoca a função atualizarGrafico
    function plotarGrafico(resposta, idAquario) {
        console.log('iniciando plotagem do gráfico...');

        var dados = {
            labels: [],
            datasets: [
                {
                    label: '',

                    data: []
                },
                {
                    yAxisID: 'y-totalpersonagens',
                    label: 'Musica Favorita',
                    backgroundColor: ['#FF1493', '#FFFF00', '#FF4500', '#00FF00', '#4B0082', '#0000FF', '#FFF'],
                    fill: true,
                    data: []
                }
            ]
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.labels.push(registro.musica);
            dados.datasets[0].data.push(registro.musica);
            dados.datasets[1].data.push(registro.voto);
            console.log(registro.voto)


        }

        console.log(JSON.stringify(dados));

        var ctx = myChart.getContext('2d');
        window.myChart = Chart.Bar(ctx, {
            data: dados,
            options: {
                responsive: true,
                animation: { duration: 900 },
                hoverMode: 'index',
                stacked: false,
                title: {
                    display: true,
                    text: 'Os Personagens mais Escolhidos'
                },

                scales: {
                    yAxes: [{
                        type: 'linear',
                        display: true,
                        position: 'left',
                        id: 'y-totalpersonagens',
                        ticks: {
                            beginAtZero: true,
                            max: 50,
                            min: 0
                        }
                    }, {
                        display: false,
                    }],
                }
            }
        });



        // Esta função atualizarGrafico atualiza o gráfico que foi renderizado na página,
        // buscando a última medida inserida em tabela contendo as capturas, 

        //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
        //     Para ajustar o "select", ajuste o comando sql em src/models
        function atualizarGrafico(idAquario, dados) {

            fetch(`/medidas/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
                if (response.ok) {
                    response.json().then(function (novoRegistro) {

                        console.log(`Dados recebidos Atualizar  Graficos: ${JSON.stringify(novoRegistro)}`);
                        console.log(dados);

                        for (i = 0; i < novoRegistro.length; i++) {
                            var registro = novoRegistro[i];
                            // tirando e colocando valores no gráfico
                            dados.labels.shift(); // apagar o primeiro
                            dados.labels.push(registro.musica);// incluir um novo momento

                            dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                            dados.datasets[0].data.push(registro.musica); // incluir uma nova medida de umidade

                            dados.datasets[1].data.shift();
                            dados.datasets[1].data.push(registro.voto);
                        }

                        window.myChart.update();

                        // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                        proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados), 2000);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados), 200000);
                }
            })
                .catch(function (error) {
                    console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
                });

        }

    }

</script>